<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expande Tu Futuro</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Inter', sans-serif; background: #07070f; color: #e0e0e0; min-height: 100vh; }
.mono { font-family: 'JetBrains Mono', monospace; }

.card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.07); border-radius: 14px; }

.btn-p { padding: 3px 13px; border-radius: 7px; font-size: 12px; font-weight: 600;
         color: rgba(255,255,255,0.3); transition: all .15s; cursor: pointer; }
.btn-p:hover:not(.active) { color: #fff; background: rgba(255,255,255,0.06); }
.btn-p.active { background: #ff007f; color: #fff; }

#chartWrap { height: 620px; }

/* Toast */
#toasts { position: fixed; top: 16px; right: 16px; z-index: 1000;
          display: flex; flex-direction: column; gap: 8px; pointer-events: none; }
.toast { padding: 11px 15px; border-radius: 11px; font-size: 13px; font-weight: 500;
         max-width: 340px; backdrop-filter: blur(14px); pointer-events: auto;
         animation: slideIn .25s ease; line-height: 1.4; }
.toast.bullish { background: rgba(0,230,118,.12); color: #00e676; border: 1px solid rgba(0,230,118,.25); }
.toast.bearish  { background: rgba(255,68,68,.12);  color: #ff5252; border: 1px solid rgba(255,68,68,.25); }
.toast.info     { background: rgba(255,0,127,.12);  color: #ff69b4; border: 1px solid rgba(255,0,127,.25); }
@keyframes slideIn { from { opacity:0; transform:translateX(12px); } to { opacity:1; transform:none; } }

/* Alerta en sidebar */
.alerta-item { padding: 8px 10px; border-radius: 9px; font-size: 11.5px; font-weight: 500; line-height: 1.4; }
.alerta-item.bullish { background: rgba(0,230,118,.08); color: #00e676; }
.alerta-item.bearish  { background: rgba(255,68,68,.08);  color: #ff5252; }
.alerta-item.info     { background: rgba(255,0,127,.08);  color: #ff69b4; }

/* Gema tag */
.gem-tag { display: inline-flex; align-items: center; gap: 5px;
           background: rgba(255,0,127,.1); border: 1px solid rgba(255,0,127,.2);
           border-radius: 20px; padding: 2px 9px; font-size: 11px; color: #ff69b4; }
.gem-tag .rm { cursor: pointer; opacity: .5; font-size: 14px; line-height: 1; }
.gem-tag .rm:hover { opacity: 1; }

/* Fav */
.fav-row { display: flex; align-items: center; justify-content: space-between;
           padding: 5px 8px; border-radius: 9px; cursor: pointer; transition: background .15s; gap: 8px; }
.fav-row:hover { background: rgba(255,255,255,0.04); }
.fav-row.active-sym { background: rgba(255,0,127,0.07); }

input:focus { outline: none; border-color: rgba(255,0,127,.5) !important; }
input[type=number]::-webkit-inner-spin-button { display: none; }

/* Scrollbar */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,.1); border-radius: 4px; }
</style>
</head>
<body>

<div id="toasts"></div>

<div class="max-w-[1600px] mx-auto p-4 lg:p-5 flex flex-col gap-4">

  <!-- ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ -->
  <header class="flex items-center justify-between gap-3 flex-wrap">
    <div class="flex items-center gap-2.5">
      <div class="w-8 h-8 rounded-lg flex items-center justify-center shrink-0"
           style="background:#ff007f;box-shadow:0 0 16px rgba(255,0,127,.4)">
        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
        </svg>
      </div>
      <span class="text-base font-bold tracking-tight">EXPANDE <span style="color:#ff007f">TU FUTURO</span></span>
    </div>

    <!-- Buscador -->
    <div class="flex items-center gap-2 flex-1 max-w-sm">
      <input id="symbolInput" type="text" placeholder="AAPL ¬∑ BTC-USD ¬∑ ^GSPC ¬∑ SPY‚Ä¶"
             class="flex-1 bg-[#111] border border-white/10 rounded-lg px-3 py-2 text-sm transition-all"
             onkeydown="if(event.key==='Enter') doSearch()">
      <button onclick="doSearch()"
              class="px-4 py-2 rounded-lg text-sm font-semibold text-white shrink-0 transition-all hover:brightness-110"
              style="background:#ff007f">Buscar</button>
    </div>
  </header>

  <!-- ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ -->
  <div class="flex flex-col lg:flex-row gap-4">

    <!-- ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ -->
    <div class="lg:w-[200px] shrink-0 flex flex-col gap-3">

      <!-- Precio -->
      <div class="card p-4">
        <div id="displaySymbol" class="text-[11px] font-bold tracking-widest mb-1" style="color:#ff007f">---</div>
        <div id="displayPrice" class="mono text-2xl font-semibold leading-tight">---</div>
        <div id="displayChange" class="text-xs mt-1.5 font-medium">--</div>

        <!-- RSI compacto -->
        <div class="mt-3 pt-3 border-t border-white/5">
          <div class="flex items-center justify-between mb-1.5">
            <span class="text-[10px] text-white/25 uppercase tracking-wider">RSI 14</span>
            <div class="flex items-center gap-1">
              <span id="rsiVal" class="mono text-sm font-bold text-white">--</span>
              <span id="rsiLbl" class="text-[9px] px-1.5 py-0.5 rounded font-bold bg-white/08 text-white/30">--</span>
            </div>
          </div>
          <div class="relative h-1.5 rounded-full overflow-visible"
               style="background:linear-gradient(to right,#00e67640 0%,#00e67640 30%,rgba(255,255,255,.08) 30%,rgba(255,255,255,.08) 70%,#ff174440 70%,#ff174440 100%)">
            <div id="rsiCur" class="absolute top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-white shadow-md"
                 style="left:50%;transform:translate(-50%,-50%);transition:left .4s"></div>
          </div>
          <div class="mt-3 space-y-1">
            <div class="flex items-center gap-1.5 text-[10px] text-white/30">
              <span class="w-2 h-2 rounded-full shrink-0" style="background:#ff007f"></span>
              ‚óè fucsia = RSI extremo
            </div>
          </div>
        </div>
      </div>

      <!-- Favoritos -->
      <div class="card p-3">
        <button onclick="toggleFavs()" class="w-full flex items-center justify-between px-1 group">
          <span class="text-[10px] uppercase tracking-widest text-white/20 font-semibold group-hover:text-white/40 transition-colors">Favoritos</span>
          <span id="favChevron" class="text-white/20 group-hover:text-white/40 transition-all duration-200 text-[10px]">‚ñ≤</span>
        </button>
        <div id="favList" class="flex flex-col gap-0.5 mt-2"></div>
      </div>

      <!-- Niveles personalizados -->
      <div class="card p-3">
        <div class="text-[10px] uppercase tracking-widest text-white/20 font-semibold mb-2 px-1">Niveles üíé</div>
        <div class="flex gap-1.5 mb-2">
          <input id="gemInput" type="number" placeholder="Precio‚Ä¶"
                 class="flex-1 min-w-0 bg-[#111] border border-white/10 rounded-lg px-2 py-1.5 text-xs transition-all"
                 onkeydown="if(event.key==='Enter') addGema()">
          <button onclick="addGema()"
                  class="px-2.5 py-1.5 rounded-lg text-xs font-bold shrink-0 transition-all hover:brightness-110"
                  style="background:rgba(255,0,127,.2);color:#ff69b4">+</button>
        </div>
        <div id="gemTags" class="flex flex-wrap gap-1"></div>
      </div>

      <!-- Alertas -->
      <div id="alertBox" class="card p-3 hidden">
        <div class="text-[10px] uppercase tracking-widest text-white/20 font-semibold mb-2 px-1">‚ö° Alertas</div>
        <div id="alertList" class="flex flex-col gap-1.5 max-h-60 overflow-y-auto"></div>
      </div>

    </div><!-- end sidebar -->

    <!-- ‚îÄ‚îÄ CHART ‚îÄ‚îÄ -->
    <div class="flex-1 card p-4">

      <!-- Controles -->
      <div class="flex items-center justify-between mb-4 gap-3 flex-wrap">
        <div class="flex gap-0.5 bg-white/5 p-0.5 rounded-xl">
          <button class="btn-p" data-p="1d"  onclick="setPeriod('1d')">1D</button>
          <button class="btn-p" data-p="5d"  onclick="setPeriod('5d')">5D</button>
          <button class="btn-p active" data-p="1mo" onclick="setPeriod('1mo')">1M</button>
          <button class="btn-p" data-p="6mo" onclick="setPeriod('6mo')">6M</button>
          <button class="btn-p" data-p="1y"  onclick="setPeriod('1y')">1Y</button>
          <button class="btn-p" data-p="2y"  onclick="setPeriod('2y')">2Y</button>
        </div>

        <!-- Leyenda inline -->
        <div class="flex items-center gap-3 flex-wrap" style="font-size:10px;color:rgba(255,255,255,.3)">
          <span><span style="color:rgba(255,255,255,.7)">‚îÄ</span> Precio</span>
          <span><span style="color:#00ffff80">‚îÄ</span> SMA20</span>
          <span><span style="color:#ffff0080">‚îÄ</span> SMA50</span>
          <span><span style="color:#fff17680">‚îÄ</span> SMA100</span>
          <span><span style="color:#ce93d880">‚îÄ</span> SMA200</span>
          <span><span style="color:#00ff00">‚Ä¢</span> ST‚ñ≤ <span style="color:#ff3333">‚Ä¢</span> ST‚ñº</span>
          <span><span style="color:#ff007f">‚óè</span> RSI</span>
        </div>
      </div>

      <div id="chartWrap">
        <canvas id="mainChart"></canvas>
      </div>
    </div>

  </div>
</div><!-- end container -->

<script>
// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentSymbol = 'BTC-USD';
let currentPeriod = '1mo';
let gemas = [];
let mainChart = null;
let sparkCharts = {};

const FAVS = [
  { name:'Bitcoin',   ticker:'BTC-USD' },
  { name:'Ethereum',  ticker:'ETH-USD' },
  { name:'S&P 500',   ticker:'^GSPC'   },
  { name:'Nasdaq 100',ticker:'^NDX'    },
  { name:'Apple',     ticker:'AAPL'    },
  { name:'SPY',       ticker:'SPY'     },
  { name:'Oro',       ticker:'GLD'     },
];

// ‚îÄ‚îÄ TOGGLE FAVORITOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let favsOpen = true;
function toggleFavs() {
  favsOpen = !favsOpen;
  const list    = document.getElementById('favList');
  const chevron = document.getElementById('favChevron');
  list.style.display   = favsOpen ? 'flex' : 'none';
  list.style.flexDirection = 'column';
  list.style.gap       = '2px';
  chevron.innerText    = favsOpen ? '‚ñ≤' : '‚ñº';
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.onload = () => {
  buildFavs();
  loadSymbol('BTC-USD');
};

// ‚îÄ‚îÄ FAVORITOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildFavs() {
  const c = document.getElementById('favList');
  c.innerHTML = '';
  FAVS.forEach(f => {
    const row = document.createElement('div');
    row.className = 'fav-row';
    row.id = 'fav-' + f.ticker.replace(/[^a-z0-9]/gi,'_');
    row.onclick = () => loadSymbol(f.ticker);
    row.innerHTML = `
      <div class="min-w-0">
        <div class="text-xs font-semibold truncate">${f.name}</div>
        <div class="mono text-[9px] text-white/25">${f.ticker}</div>
      </div>
      <div class="flex flex-col items-end gap-0.5 shrink-0">
        <canvas id="spark-${f.ticker.replace(/[^a-z0-9]/gi,'_')}" width="52" height="20"></canvas>
        <span id="pct-${f.ticker.replace(/[^a-z0-9]/gi,'_')}" class="mono text-[9px] text-white/25">‚Ä¶</span>
      </div>`;
    c.appendChild(row);
    loadSparkline(f.ticker);
  });
}

async function loadSparkline(ticker) {
  try {
    const res = await fetch(`/api/sparkline/${ticker}`);
    const d   = await res.json();
    if (!d.closes || d.closes.length < 2) return;
    const id  = ticker.replace(/[^a-z0-9]/gi,'_');
    const cvs = document.getElementById(`spark-${id}`);
    if (!cvs) return;
    if (sparkCharts[ticker]) sparkCharts[ticker].destroy();
    const up = d.pct >= 0;
    sparkCharts[ticker] = new Chart(cvs.getContext('2d'), {
      type: 'line',
      data: {
        labels: d.closes.map((_,i) => i),
        datasets: [{ data: d.closes,
          borderColor: up ? '#00e676' : '#ff4444',
          backgroundColor: up ? 'rgba(0,230,118,.07)' : 'rgba(255,68,68,.07)',
          borderWidth: 1.5, fill: true, tension: 0.3, pointRadius: 0 }]
      },
      options: { responsive: false, animation: false,
        plugins: { legend: { display:false }, tooltip: { enabled:false } },
        scales: { x: { display:false }, y: { display:false } } }
    });
    const pEl = document.getElementById(`pct-${id}`);
    if (pEl) { pEl.style.color = up ? '#00e676' : '#ff4444'; pEl.innerText = `${up?'+':''}${d.pct.toFixed(2)}%`; }
  } catch(e) {}
}

// ‚îÄ‚îÄ GEMAS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addGema() {
  const v = parseFloat(document.getElementById('gemInput').value);
  if (!isNaN(v) && v > 0 && !gemas.includes(v)) {
    gemas.push(v);
    document.getElementById('gemInput').value = '';
    renderGemTags();
    refreshChart();
  }
}
function removeGema(v) {
  gemas = gemas.filter(g => g !== v);
  renderGemTags();
  refreshChart();
}
function renderGemTags() {
  document.getElementById('gemTags').innerHTML = gemas.map(g =>
    `<span class="gem-tag">$${g.toLocaleString()}<span class="rm" onclick="removeGema(${g})">√ó</span></span>`
  ).join('');
}

// ‚îÄ‚îÄ FETCH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function fetchData(symbol, period) {
  const nv  = gemas.join(',');
  const res = await fetch(`/api/chart/${encodeURIComponent(symbol)}?period=${period}&niveles=${nv}`);
  const d   = await res.json();
  if (d.error) throw new Error(d.error);
  return d;
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderChart(data) {
  const ctx = document.getElementById('mainChart').getContext('2d');
  if (mainChart) mainChart.destroy();

  // L√≠neas horizontales de niveles personalizados
  const gemColors = ['#ff69b4','#ffa040','#80ff80','#80d4ff','#d4a0ff'];
  const gemasDS = data.gemas.map((g, i) => ({
    label: `Nivel $${g.toLocaleString()}`,
    data:  Array(data.chart.labels.length).fill(g),
    borderColor: gemColors[i % gemColors.length],
    backgroundColor: 'transparent',
    borderWidth: 1, borderDash: [6,4],
    fill: false, pointRadius: 0, tension: 0, yAxisID: 'y'
  }));

  mainChart = new Chart(ctx, {
    type: 'line',
    data: { labels: data.chart.labels, datasets: [...data.chart.datasets, ...gemasDS] },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: { duration: 250 },
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(8,8,20,.92)',
          borderColor: 'rgba(255,255,255,.08)',
          borderWidth: 1,
          titleColor: '#fff',
          bodyColor: 'rgba(255,255,255,.6)',
          padding: 10,
          callbacks: {
            label: ctx => {
              if (ctx.parsed.y === null) return null;
              return ` ${ctx.dataset.label}: ${ctx.parsed.y.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}`;
            }
          }
        }
      },
      scales: {
        y: {
          display: true, position: 'left',
          grid: { color: 'rgba(255,255,255,0.035)', drawBorder: false },
          ticks: { color: 'rgba(255,255,255,.3)', font: { size: 10 },
                   callback: v => v >= 1000 ? v.toLocaleString() : v.toFixed(2) }
        },
        x: {
          grid: { display: false },
          ticks: { color: 'rgba(255,255,255,.25)', font: { size: 10 }, maxTicksLimit: 10 }
        }
      }
    }
  });

  // Panel precio
  document.getElementById('displaySymbol').innerText = currentSymbol;
  document.getElementById('displayPrice').innerText  =
    data.last_price.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});

  const chEl = document.getElementById('displayChange');
  const pre  = data.change >= 0 ? '+' : '';
  chEl.innerText   = `${pre}${data.change.toFixed(2)} (${pre}${data.change_pct.toFixed(2)}%)`;
  chEl.style.color = data.change >= 0 ? '#00e676' : '#ff4444';

  updateRSI(data.rsi_current);
  renderAlertas(data.alertas);
}

function updateRSI(v) {
  v = parseFloat(v);
  document.getElementById('rsiVal').innerText = v.toFixed(1);
  document.getElementById('rsiCur').style.left = `calc(${Math.min(Math.max(v,0),100)}% - 4px)`;
  const lbl = document.getElementById('rsiLbl');
  const val = document.getElementById('rsiVal');
  if (v < 30) {
    lbl.innerText = 'SV'; lbl.style.cssText = 'font-size:9px;padding:1px 5px;border-radius:4px;background:rgba(0,230,118,.12);color:#00e676;font-weight:700;';
    val.style.color = '#00e676';
  } else if (v > 70) {
    lbl.innerText = 'SC'; lbl.style.cssText = 'font-size:9px;padding:1px 5px;border-radius:4px;background:rgba(255,68,68,.12);color:#ff5252;font-weight:700;';
    val.style.color = '#ff5252';
  } else {
    lbl.innerText = 'N'; lbl.style.cssText = 'font-size:9px;padding:1px 5px;border-radius:4px;background:rgba(255,255,255,.06);color:rgba(255,255,255,.3);font-weight:700;';
    val.style.color = '#fff';
  }
}

function renderAlertas(alertas) {
  const box  = document.getElementById('alertBox');
  const list = document.getElementById('alertList');
  if (!alertas || alertas.length === 0) { box.classList.add('hidden'); return; }
  box.classList.remove('hidden');
  list.innerHTML = alertas.map(a =>
    `<div class="alerta-item ${a.nivel}">${a.msg}</div>`
  ).join('');
  // Mostrar toasts
  alertas.forEach(a => showToast(a.msg, a.nivel));
}

function showToast(msg, nivel) {
  const c = document.getElementById('toasts');
  const t = document.createElement('div');
  t.className = `toast ${nivel}`;
  t.innerText = msg;
  c.appendChild(t);
  setTimeout(() => t.remove(), 7000);
}

// ‚îÄ‚îÄ CONTROL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadSymbol(sym) {
  currentSymbol = sym;
  document.getElementById('symbolInput').value = sym;

  // Highlight activo
  document.querySelectorAll('.fav-row').forEach(r => r.classList.remove('active-sym'));
  const el = document.getElementById('fav-' + sym.replace(/[^a-z0-9]/gi,'_'));
  if (el) el.classList.add('active-sym');

  try {
    const data = await fetchData(sym, currentPeriod);
    renderChart(data);
  } catch(e) {
    showToast('‚ùå ' + e.message, 'bearish');
  }
}

function doSearch() {
  const sym = document.getElementById('symbolInput').value.trim().toUpperCase();
  if (sym) loadSymbol(sym);
}

function refreshChart() { loadSymbol(currentSymbol); }

function setPeriod(p) {
  currentPeriod = p;
  document.querySelectorAll('.btn-p').forEach(b => b.classList.toggle('active', b.dataset.p === p));
  refreshChart();
}
</script>
</body>
</html>
